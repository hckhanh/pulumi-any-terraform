---
title: PostHog Provider
description: Manage PostHog analytics, feature flags, and product insights with Pulumi
---

The PostHog provider enables you to manage product analytics, feature flags, and event tracking resources in PostHog using Pulumi. This provider is dynamically bridged from the [Terraform PostHog Provider](https://registry.terraform.io/providers/PostHog/posthog).

## Installation

Install the PostHog provider package using your preferred package manager:

<Tabs items={['bun', 'pnpm', 'yarn', 'npm']}>
  <Tab value="bun">
    ```bash
    bun add pulumi-posthog
    ```
  </Tab>
  <Tab value="pnpm">
    ```bash
    pnpm add pulumi-posthog
    ```
  </Tab>
  <Tab value="yarn">
    ```bash
    yarn add pulumi-posthog
    ```
  </Tab>
  <Tab value="npm">
    ```bash
    npm install pulumi-posthog
    ```
  </Tab>
</Tabs>

## Configuration

### Getting API Key

1. Log in to your PostHog instance at [app.posthog.com](https://app.posthog.com) (or your self-hosted URL)
2. Navigate to Settings → User → Personal API Keys
3. Click "Create Personal API Key"
4. Copy the generated API key (starts with `phx_`)

### Provider Setup

```bash
pulumi config set posthog:apiKey YOUR_API_KEY --secret
pulumi config set posthog:host https://us.posthog.com
```

Or using environment variables:

```bash
export POSTHOG_API_KEY="phx_your_api_key_here"
export POSTHOG_HOST="https://app.posthog.com"
```

### Self-Hosted PostHog

If you're using a self-hosted PostHog instance:

```bash
pulumi config set posthog:host https://posthog.yourcompany.com
```

## Quick Start

```typescript
import * as pulumi from "@pulumi/pulumi";
import * as posthog from "pulumi-posthog";

// Create a feature flag
const betaFeature = new posthog.FeatureFlag("beta-feature", {
    key: "new-dashboard",
    name: "New Dashboard Beta",
    active: true,
    // filters must be a JSON string, not an object
    filters: JSON.stringify({
        groups: [{
            properties: [],
            rolloutPercentage: 25,
        }],
    }),
});

// Export the feature flag key
export const featureFlagKey = betaFeature.key;
```

## Key Features

### Feature Flags

Manage feature flags with advanced targeting and rollout strategies:

```typescript
// Simple percentage rollout
const gradualRollout = new posthog.FeatureFlag("gradual-rollout", {
    key: "new-feature",
    name: "New Feature",
    active: true,
    filters: JSON.stringify({
        groups: [{
            properties: [],
            rolloutPercentage: 10, // 10% of users
        }],
    }),
});

// Targeted rollout with properties
const targetedFlag = new posthog.FeatureFlag("premium-feature", {
    key: "premium-features",
    name: "Premium Features",
    active: true,
    filters: JSON.stringify({
        groups: [{
            properties: [{
                key: "plan",
                value: "premium",
                type: "person",
                operator: "exact",
            }],
            rolloutPercentage: 100,
        }],
    }),
});
```

### Dashboards

Create and manage analytics dashboards:

```typescript
const analyticsDashboard = new posthog.Dashboard("analytics", {
    name: "Product Analytics",
    description: "Key metrics for product performance",
    pinned: true,
});
```

### Insights

Configure analytics insights and queries:

```typescript
const pageviewInsight = new posthog.Insight("pageviews", {
    name: "Pageview Trends",
    queryJson: JSON.stringify({
        kind: "TrendsQuery",
        series: [{
            kind: "EventsNode",
            event: "$pageview",
            name: "$pageview",
        }],
        dateRange: {
            date_from: "-30d",
        },
    }),
});
```

### Alerts

Set up alerts for important metrics:

```typescript
const errorAlert = new posthog.Alert("error-alert", {
    name: "High Error Rate",
    // Use the numeric insight ID from PostHog (find in insight URL or API)
    insight: 12345,
    enabled: true,
    thresholdType: "absolute",
    thresholdUpper: 100,
    // Array of PostHog user IDs to notify (find in user settings)
    subscribedUsers: [67890],
});
```

### Hog Functions

Configure custom Hog functions for data transformation:

```typescript
const customTransform = new posthog.HogFunction("transform", {
    name: "Custom Event Transform",
    enabled: true,
    type: "transformation",
    hog: `
        fun transform(event) {
            event.properties.processed = true
            return event
        }
    `,
    filtersJson: JSON.stringify({
        events: [{ id: "$pageview" }],
    }),
});
```

## Common Use Cases

### Complete Feature Flag Setup

```typescript
import * as pulumi from "@pulumi/pulumi";
import * as posthog from "pulumi-posthog";

// Create a beta feature with gradual rollout
const betaFeature = new posthog.FeatureFlag("beta-feature", {
    key: "new-checkout",
    name: "New Checkout Experience",
    active: true,
    filters: JSON.stringify({
        groups: [
            {
                // 100% for beta testers
                properties: [{
                    key: "is_beta_tester",
                    value: true,
                    type: "person",
                    operator: "exact",
                }],
                rolloutPercentage: 100,
            },
            {
                // 5% for everyone else
                properties: [],
                rolloutPercentage: 5,
            },
        ],
    }),
});

// Create an experiment
const checkoutExperiment = new posthog.FeatureFlag("checkout-experiment", {
    key: "checkout-variant",
    name: "Checkout A/B Test",
    active: true,
    filters: JSON.stringify({
        groups: [{
            properties: [],
            rolloutPercentage: 100,
        }],
        multivariate: {
            variants: [
                {
                    key: "control",
                    name: "Control",
                    rolloutPercentage: 50,
                },
                {
                    key: "variant-a",
                    name: "Variant A",
                    rolloutPercentage: 50,
                },
            ],
        },
    }),
});

export const betaFlagKey = betaFeature.key;
export const experimentKey = checkoutExperiment.key;
```

### Analytics Dashboard Setup

```typescript
import * as pulumi from "@pulumi/pulumi";
import * as posthog from "pulumi-posthog";

// Create insights
const signupInsight = new posthog.Insight("signups", {
    name: "User Signups",
    queryJson: JSON.stringify({
        kind: "TrendsQuery",
        series: [{
            kind: "EventsNode",
            event: "user_signed_up",
            name: "User Signed Up",
        }],
        dateRange: {
            date_from: "-30d",
        },
    }),
});

const retentionInsight = new posthog.Insight("retention", {
    name: "User Retention",
    queryJson: JSON.stringify({
        kind: "RetentionQuery",
        retentionFilter: {
            targetEntity: {
                id: "user_signed_up",
                type: "events",
            },
            returningEntity: {
                id: "$pageview",
                type: "events",
            },
        },
        dateRange: {
            date_from: "-90d",
        },
    }),
});

// Create dashboard with insights
const dashboard = new posthog.Dashboard("product-dashboard", {
    name: "Product Metrics",
    description: "Key product performance metrics",
    pinned: true,
});

// Set up alerts (requires numeric insight ID from PostHog)
const signupAlert = new posthog.Alert("signup-alert", {
    name: "Low Signup Alert",
    // Get insight ID from PostHog insight URL or API
    insight: 12345,
    enabled: true,
    thresholdType: "absolute",
    thresholdLower: 10,
    // Get user IDs from PostHog user settings or API
    subscribedUsers: [67890],
});

export const dashboardId = dashboard.id;
```

## Best Practices

### 1. Feature Flag Naming

Use clear, descriptive keys for feature flags:

```typescript
// Good
const flag = new posthog.FeatureFlag("payment-redesign", {
    key: "payment-redesign-2024",
    name: "Payment Flow Redesign (2024)",
    active: true,
});

// Avoid
const flag = new posthog.FeatureFlag("flag1", {
    key: "flag1",
    name: "Flag 1",
    active: true,
});
```

### 2. Gradual Rollouts

Start with small percentages and increase gradually:

```typescript
const rollout = new posthog.FeatureFlag("major-feature", {
    key: "major-feature",
    name: "Major Feature",
    active: true,
    filters: JSON.stringify({
        groups: [{
            properties: [],
            rolloutPercentage: 5, // Start with 5%
        }],
    }),
});
```

### 3. Use Consistent Rollouts

Ensure stable user experience with proper rollout configuration:

```typescript
const stableFlag = new posthog.FeatureFlag("ui-change", {
    key: "ui-change",
    name: "UI Change",
    active: true,
    filters: JSON.stringify({
        groups: [{
            properties: [],
            rolloutPercentage: 50,
        }],
    }),
});
```

### 4. Target Specific User Segments

Use properties for precise targeting:

```typescript
const enterpriseFlag = new posthog.FeatureFlag("enterprise-features", {
    key: "enterprise-features",
    name: "Enterprise Features",
    active: true,
    filters: JSON.stringify({
        groups: [{
            properties: [
                {
                    key: "plan",
                    value: ["enterprise", "business"],
                    type: "person",
                    operator: "in",
                },
                {
                    key: "company_size",
                    value: 100,
                    type: "person",
                    operator: "gte",
                },
            ],
            rolloutPercentage: 100,
        }],
    }),
});
```

## Resource Types

| Resource | Description | Common Use Cases |
|----------|-------------|------------------|
| `FeatureFlag` | Feature flag management | A/B testing, gradual rollouts, targeted features |
| `Dashboard` | Analytics dashboard | Monitoring, reporting, data visualization |
| `Insight` | Analytics query/insight | Event analysis, funnels, retention, trends |
| `Alert` | Metric alerts | Anomaly detection, threshold monitoring |
| `HogFunction` | Custom data processing | Event transformation, custom logic |

## Troubleshooting

### Common Issues

#### API Authentication Error
```
Error: 401 Unauthorized
```

**Solution**: Verify your API key is correct and starts with `phx_`. Check that it hasn't expired.

```bash
pulumi config set posthog:apiKey phx_your_key_here --secret
```

#### Invalid Host Configuration
```
Error: Connection refused
```

**Solution**: Ensure your host URL is correct and includes the protocol:

```bash
# Correct
pulumi config set posthog:host https://app.posthog.com

# Incorrect (missing protocol)
pulumi config set posthog:host app.posthog.com
```

#### Feature Flag Not Updating
```
Error: Resource already exists
```

**Solution**: Use unique keys for feature flags. If updating, ensure the key matches:

```typescript
const flag = new posthog.FeatureFlag("my-flag", {
    key: "unique-feature-key", // Must be unique
    name: "My Feature",
    active: true,
});
```

#### Permission Denied
```
Error: 403 Forbidden
```

**Solution**: Ensure your API key has the necessary permissions. Personal API keys need appropriate project access.

## Advanced Configuration

### Multi-Environment Setup

```typescript
import * as pulumi from "@pulumi/pulumi";
import * as posthog from "pulumi-posthog";

const config = new pulumi.Config();
const environment = config.require("environment");

// Environment-specific feature flag
const envFlag = new posthog.FeatureFlag(`${environment}-feature`, {
    key: `${environment}-feature`,
    name: `${environment} Feature`,
    active: environment === "production",
    filters: JSON.stringify({
        groups: [{
            properties: [],
            rolloutPercentage: environment === "production" ? 100 : 0,
        }],
    }),
});
```

### Integration with CI/CD

```typescript
// Automated feature flag deployment
const ciFlag = new posthog.FeatureFlag("ci-deployment", {
    key: "new-feature",
    name: "New Feature",
    active: true,
    filters: JSON.stringify({
        groups: [{
            properties: [],
            rolloutPercentage: pulumi.getStack() === "production" ? 100 : 50,
        }],
    }),
});
```

## Resource Reference

### FeatureFlag

**Required Arguments:**
- `key` (string): Unique identifier for the feature flag

**Optional Arguments:**
- `name` (string): Display name for the feature flag
- `active` (boolean): Whether the flag is active (default: true)
- `filters` (string): JSON string containing targeting and rollout configuration with groups, properties, and conditions
- `rolloutPercentage` (number): Simple overall rollout percentage (0-100) - use this for basic rollouts or `filters` for advanced targeting
- `tags` (string[]): Set of tags for the feature flag

**Note**: For advanced targeting with user properties and multiple groups, use the `filters` property. For simple percentage-based rollouts, you can use either `rolloutPercentage` or configure it within `filters`.

**Attributes:**
- `featureFlagId`: Numeric feature flag ID
- `key`: Feature flag key
- `active`: Current active status

### Dashboard

**Required Arguments:**
- `name` (string): Dashboard name

**Optional Arguments:**
- `description` (string): Dashboard description
- `pinned` (boolean): Pin to top of dashboard list

**Attributes:**
- `id`: Dashboard ID
- `name`: Dashboard name

### Insight

**Required Arguments:**
- `queryJson` (string): Raw JSON serialized query payload accepted by PostHog (e.g., `InsightVizNode` with a `TrendsQuery`)

**Optional Arguments:**
- `name` (string): Insight name
- `description` (string): Insight description
- `dashboardIds` (number[]): List of dashboard IDs to add the insight to
- `createInFolder` (string): Folder where the insight is created
- `tags` (string[]): List of tags to apply to the insight
- `deleted` (boolean): Whether the insight is deleted (soft delete)
- `derivedName` (string): Insight derived name (auto-generated by PostHog when name is not set)

**Attributes:**
- `insightId`: Numeric insight ID
- `name`: Insight name
- `derivedName`: Auto-generated insight name

### Alert

**Required Arguments:**
- `insight` (number): Numeric ID of the insight this alert monitors
- `thresholdType` (string): Type of threshold - `"absolute"` for fixed values or `"percentage"` for relative changes
- `subscribedUsers` (number[]): List of user IDs to notify when the alert fires

**Optional Arguments:**
- `name` (string): Alert name
- `enabled` (boolean): Whether alert is enabled (default: true)
- `thresholdLower` (number): Lower bound of the threshold - alert fires when value goes below this
- `thresholdUpper` (number): Upper bound of the threshold - alert fires when value goes above this
- `calculationInterval` (string): How often to check - `"hourly"`, `"daily"`, `"weekly"`, or `"monthly"`
- `conditionType` (string): Condition type - `"absoluteValue"`, `"relativeIncrease"`, or `"relativeDecrease"`
- `seriesIndex` (number): Index of the trend series to monitor (0-based)
- `checkOngoingInterval` (boolean): Whether to check the ongoing (incomplete) interval
- `skipWeekend` (boolean): Whether to skip checking the alert on weekends

**Attributes:**
- All configured properties

### HogFunction

**Optional Arguments (all optional):**
- `name` (string): Name of the Hog function
- `description` (string): Description of the Hog function
- `enabled` (boolean): Whether the Hog function is enabled (default: true)
- `hog` (string): The Hog code to execute (not required when using a template)
- `type` (string): Type of Hog function - `"destination"`, `"siteDestination"`, `"internalDestination"`, `"sourceWebhook"`, `"siteApp"`, or `"transformation"`
- `filtersJson` (string): JSON string defining filters for when the Hog function should execute
- `inputsJson` (string): JSON string containing the input values for the Hog function
- `mappingsJson` (string): JSON array of mapping configurations
- `maskingJson` (string): JSON object configuring PII masking
- `templateId` (string): ID of a template to use as the basis for this Hog function
- `executionOrder` (number): Order in which this Hog function executes (0-32767)
- `iconUrl` (string): URL of the icon for this Hog function

**Attributes:**
- All configured properties

## Additional Resources

- [PostHog Documentation](https://posthog.com/docs)
- [PostHog API Reference](https://posthog.com/docs/api)
- [Terraform PostHog Provider](https://registry.terraform.io/providers/PostHog/posthog/latest/docs)
- [Feature Flags Guide](https://posthog.com/docs/feature-flags)
- [Product Analytics Guide](https://posthog.com/docs/product-analytics)
